# 利用深度学习预测银行漂亮开盘价

> 原文:[https://blog . quantin STI . com/predict-bank-nifty-open-price-deep-learning-epat-project-balamurugan/](https://blog.quantinsti.com/predict-bank-nifty-open-price-deep-learning-epat-project-balamurugan/)

随着几种机器/深度学习模型的出现，由于其涉及的难度和复杂性，在应用这些技术进行股票市场预测时出现了几种理论。在这个项目中，我们试图解决这个问题，使用一个分类器来预测 NSE 中列出的 Bank Nifty 指数在第二天开盘时是上涨还是下跌，使用了两个深度学习模型。

本文是作者在 QuantInsti<sup>T5【EPAT<sup>】的算法交易[高管课程中提交的期末项目的一部分。请务必查看我们的](https://www.quantinsti.com)[项目页面](/tag/epat-trading-projects/)，看看我们的学生正在构建什么。</sup></sup>

### 关于作者

![](../Images/0b09d9da87f57f11e95b7f5fe55542f1.png) [Balamurugan Ganesan](https://www.google.com/url?q=https://www.linkedin.com/in/balamurugan-ganesan-93024aa/&sa=D&ust=1579163437003000) 是一名产品专业人士，拥有 SP Jain 的金融 MBA 学位、NIT Calicut 的技术学士学位，并完成了 CFA 三级考试。他拥有约 11 年的商业分析师/产品经理经验，在金融科技行业的产品建设方面有着良好的记录。目前，他是美国银行的首席分析师。

在 EPAT 的领导下，他在算法交易领域的行业专家、从业者和坚定者的指导下，对量化金融和高频交易的各种现实世界实施技术有了深入的了解。

他在构建产品时广泛使用了最新技术，例如在 tensorflow / keras 中实现深度学习模型，在 Scikit Learn 中实现机器学习，使用 Python 实现统计分析工具。

他非常热衷于算法交易领域，在那里他可以很好地利用他所有的技能。

### 项目摘要

这个项目着眼于开发一个深度学习模型来预测银行 NIFTY 指数第二天开盘价的方向。这个项目我考虑了两个深度学习模型。

1.  一个深度学习模型，用于根据当天的 1 分钟 OHLC 盘中数据预测 BANK NIFTY 第二天开盘价的方向。
2.  一个深度学习模型，用于预测前 5 大银行 Nifty 成份股的第二天开盘价方向(按权重)。考虑的股票有:

*   HDFC 银行
*   ICICI 银行
*   轴心银行
*   Kotak Bank
*   印度国家银行

基于两个深度学习模型的预测，我们可以决定第二天 BANK NIFTY 的模型预测强度。

如果银行 NIFTY 模型预测的开盘价高于当前收盘价，而个股模型也预测了更高的开盘价，那么我们会认为这是一个强烈的买入信号，反之亦然。我们只考虑第二天两个模型预测方向相同的情况。

我们试图预测这个项目的开盘价，因为从前一天收盘价的开盘价漂移中可以获得最佳回报。大多数情况下，在一个向上/向下跳空开盘后，价格开始围绕开盘价盘整一天。

与回报类似，隔夜头寸的风险也高于日内头寸。我还根据前一天的收盘价对所有四种价格(OHLC)的变动进行了实验，得到了对“开盘价”的最佳预测。

**股票模型的 AUC 得分是值得称赞的 83%,指数模型的 AUC 得分在 60%以上。**从这个项目中，我们可以了解到深度学习模型可以用于预测市场运动和趋势。

该项目只是展示了一个框架，在给定数据可用性和技术约束的情况下，开发一个具有良好预测能力的深度学习模型。有了更多的训练数据和计算能力，我们可以开发一个具有很好预测能力的稳健模型。

### 项目动机

随着几种机器/深度学习模型的出现，由于其涉及的难度和复杂性，在将这些技术应用于[股市预测](https://quantra.quantinsti.com/course/trading-with-machine-learning-regression target=)时出现了几种理论。

在这个项目中，我试图解决这个问题，使用一个分类器来预测银行 NIFTY 指数在第二天开盘时是上涨还是下跌。

为此，除了开盘价、最高价、最低价、收盘价和成交量的历史数据之外，我将使用一些技术指标来预测指数中的个股价格。

对于银行 NIFTY 模型，我将使用前一天的 1 分钟内数据。

深度学习模型将使用历史数据来检测历史数据中的非线性模式，并基于从训练集中的学习来预测指数以及指数的个股的第二天开盘价。

### 技术设置

该项目使用 Python 版本 3.5.6

其他主要库和数据库版本:

*   Tensorflow - 1.11.0
*   Keras - 2.2.4
*   Sklearn - 0.20.0
*   塔利布- 0.4.17
*   Imblearn - 0.5.0
*   MySQL 8

### 使用的数据集

对于**股票模型**，使用股票从 2000 年 1 月到 2019 年 9 月的 20 年每日 OHLCV 数据。截至 2018 年 12 月的数据用于训练/交叉验证，2019 年的数据用作测试集。

类似地，对于**指数模型**，使用了 BANK NIFTY 从 2018 年 1 月到 2019 年 9 月的第一个和最后一个小时(上午 9:16 到 10:15，下午 2:30 到 3:30)的 21 个月的 1 分钟盘中数据。截至 2019 年 4 月的数据用于训练/交叉验证，最近 5 个月的数据用作测试集。

### 股票的模型实现

广泛用于股票价格预测的预测指标是使用每日价格和交易量数据计算的技术指标。因此，我开始使用这些指标中的几个作为特征来开发模型，以检查预测能力。

接下来，我定义了我们将使用该模型预测的目标变量(y)。由于问题已经被框定为一个[分类](https://quantra.quantinsti.com/course/trading-machine-learning-classification-svm)问题，我将把目标变量定义为一个二元分类器。如果第(t+1) <sup>日</sup>的开盘价大于第 t <sup>日</sup>的开盘价，那么第 t <sup>日</sup>的目标变量将被定义为‘1’，否则为‘0’。

在定义了目标变量之后，我想找出不同特性的有效性。为了检查每个指标的特征重要性，我首先使用 XGBClassifier 来训练数据集，然后利用 XGBClassifier 的特征重要性功能来筛选重要特征。

下面是使用 HDFCBANK 的 XGBClassifier 提取重要特征的代码片段

![](../Images/81039c0b020c9cd578390e6511ae8658.png)

我创建了自己的 MySQL 数据库来存储这个项目所需的每日和当天数据。createFeatures 是创建独立特征的自定义函数。

执行上述代码片段后，我们得到如下所示的输出。

![](../Images/fcd69ac470c2505108543c407c423d06.png)

![](../Images/ee170fbe2ad9b20f3bb7d81221c7f0b5.png)

通过分析混淆矩阵、分类报告、AUC 分数和特征重要性，我们可以得出具有良好预测能力的最佳特征数量，并在我们的深度学习模型中使用它们。我不得不花大量时间反复试验来决定要使用的特性。

最后，以下特征是人工[神经网络模型](https://quantra.quantinsti.com/course/neural-networks-deep-learning-trading-ernest-chan)的一部分

1.  前一天 OHLC 数据之间差异的不同组合

![](../Images/54f7d9298632c379fe2891a6b58091cc.png)

2.  以下技术指标

1.  势头指标

1.ADX-ADX 指示市场方向，以及是否有趋势或动力存在于同一个方向。数值范围从 0 到 100，数值越大表示趋势越强。

2.RSI——相对强弱计算的是最近价格向上运动与绝对价格运动的比率。相对强弱指数从 0 到 100 不等。当值超过 70/低于 30 时，RSI 被解释为超买/超卖指标。

3.CCI——商品通道指数衡量证券价格与其统计平均值的差异。该指标用于计算超买/超卖区域。

4.ROC——ROC 衡量当前价格和一定时期之前价格之间的百分比变化。它通常用于发现超买/超卖情况。

2.  波动指标

1.ATR——平均真实范围表明在给定的时间范围内，股票的平均波动幅度。该指标可以帮助确定开始交易的水平，也可以确定日内交易者的止损水平。

2.布林线-布林线显示了一个证券价格在特定的持续时间内达到的不同的高点和低点，以及它的相对强度。根据波动性的不同，波动带会变宽(高波动性)和变窄(低波动性)。

3.  音量指示器

1.ADOSC——Chaikin A/D 振荡器是一种成交量指标，它将价格和成交量的变化联系起来。该指标基于一个前提，即价格变动伴随的交易量越大，价格变动就越显著。

2.力量指数——力量指数使用价格和交易量来评估一个动作背后的力量或者识别可能的转折点。

4.  移动平均线

1.简单移动平均线

2.指数移动平均线

基于上述特征，使用 Keras 设计了以下人工神经网络模型。

同样，超参数像隐藏层、隐藏节点、内核初始化器、优化器等等都是基于大量的试验和错误最终确定的。

下面给出了代码片段，它适用于所有五个股票符号。

![](../Images/0667a284871bbd981f63f5852c7793a5.png)

使用 StandardScaler 对所有输入要素进行缩放，以确保它们都在相同的比例上。为了避免过度拟合，在拟合模型时，使用参数验证分割来利用 30%的训练集进行交叉验证。

Keras 的几个回调函数也被用来保存最佳模型，如果它没有改善超过预定义的阈值，则停止训练过程。

下面的代码片段运行所有五只股票的模型。

![](../Images/6d82fa66c4c5c03d36bcf63bbfb55baa.png)

### 主要发现

基于测试数据集上的混淆矩阵、分类报告和 AUC 分数来评估模型的性能。

下面给出了所有五种股票的结果。

![](../Images/babad916508a2fecf816f4893553cb3e.png)

![](../Images/763a743d2a56a9ac3933ccf77026f8e1.png)

![](../Images/e60aeb6384a949474d8adf71f7f80e9f.png)

![](../Images/e958c8a1be422941a57a82035574f42f.png)

![](../Images/9f2fb6550d293ec69c9db08ba5ffd997.png)

该模型对所有五只股票都取得了 83%及以上的相当高的 AUC 分数。

### 索引的模型实现

对于 BANK NIFTY，前一天的第一个和最后一个小时的日内 OHLC 数据在上午 09:16 至 10:15 和下午 2:30 至 3:30 用于预测该指数的第二天开盘价。没有使用其他附加功能。

第二天的开盘价是使用不同日内时间框架的模型预测的，并发现这种组合具有良好的预测能力。我不能超过 120 分钟，因为随着时间的增加，复杂性和计算能力的要求不断增加。

使用下面的代码片段对数据进行了重新采样。

![](../Images/195364a3d744891aa18112516c2fe0c1.png)

训练数据中存在一些数据不平衡。如下图所示，第二天开盘价上涨的次数远远高于第二天开盘价下跌的次数。

![](../Images/7b24884782528c83ea88409e95280462.png)

这种数据不平衡可能会妨碍模型的学习。因此，从 imblearn 库中使用了一个名为 **SMOTE** 的方法来对数据进行过采样，并使目标类的数量相等。

![](../Images/d150fd0653b18ef9efaadd508c783612.png)

![](../Images/b59fb07ee4b75fe2d7a16a2154d1d28c.png)

使用 StandardScaler 对所有输入要素进行缩放，以确保它们都在相同的比例上。与股票模型类似，该模型是在对超参数进行多次反复试验后最终确定的。

对于这个模型， **sgd** 优化器和 **he_uniform** 初始化器似乎工作得更好。该模型使用 16 个月的日内数据(2018 年 1 月至 2019 年 4 月)进行训练，并使用 30%的数据进行交叉验证，以避免过度拟合。模型的代码片段如下所示。

![](../Images/fb597334238f8ac3e880662ebfdff133.png)

Keras 的类似回调函数像以前的模型一样保存最佳模型，早期停止也用于索引模型。

### 主要发现

在 2019 年 5 月至 2019 年 9 月的测试数据集上，基于与上述模型相似的混淆矩阵、分类报告和 AUC 得分来评估模型的性能。

![](../Images/469f96a91cab882e6944d439bd2fb4c9.png)

该模型的 AUC 分数约为 60%,这对于一个自我训练的模型来说相当不错。

### 结合两种模型

我们现在可以结合两个模型的预测能力来做出交易决策。由于股票模型试图预测银行 nifty 的前五只成分股的开盘价，如果股票和指数模型预测的方向相同，那么预测的概率就会很高。此步骤尚未在当前项目中实现。

### 结论

从这个项目中，我们可以了解到深度学习模型可以用于预测市场运动和趋势。

该项目只是展示了一个框架，在给定数据可用性和技术约束的情况下，开发一个具有良好预测能力的基本模型。有了更多的训练数据和计算能力，我们可以开发一个具有很好预测能力的稳健模型。

当前模型可以通过使用从上午 9:15 到下午 3:15(360 分钟)的单个股票和 BANK NIFTY 的当天 1 分钟数据来增强，并基于对指数/股票中第二天开市的模型预测在当天的最后 15 分钟建仓。

我们也可以尝试预测第二天的收盘价或区间(高-低)，并据此做出交易决定。为此，我们需要更多的数据和计算能力。

如果你想学习算法交易的各个方面，那就去看看算法交易的[执行课程(EPAT )。](https://www.quantinsti.com)课程涵盖统计学&计量经济学、金融计算&技术和算法&量化交易等培训模块。EPAT 教你在算法交易中建立一个有前途的职业所需的技能。[现在就询问](https://www.quantinsti.com)！

免责声明:就我们学生所知，本项目中的信息是真实和完整的。学生或 QuantInsti 不保证提供所有推荐。学生和 QuantInsti 否认与这些信息的使用有关的任何责任。本项目中提供的所有内容仅供参考，我们不保证通过使用该指南您将获得一定的利润。

**下载中的文件:**

*   数据
*   数据处理
*   索引
*   股票